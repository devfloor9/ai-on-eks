"use strict";(globalThis.webpackChunkdoeks_website=globalThis.webpackChunkdoeks_website||[]).push([[8840],{39873(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"infra/agents-on-eks","title":"Agents on EKS","description":"The Agents on EKS infrastructure deploys an environment that supports continuously building, deploying, and evaluating AI agents using open source tools in a secure, scalable, and reliable manner.","source":"@site/docs/infra/agents-on-eks.md","sourceDirName":"infra","slug":"/infra/agents-on-eks","permalink":"/ai-on-eks/docs/infra/agents-on-eks","draft":false,"unlisted":false,"editUrl":"https://github.com/awslabs/ai-on-eks/blob/main/website/docs/infra/agents-on-eks.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Agents on EKS"},"sidebar":"infra","previous":{"title":"Troubleshooting","permalink":"/ai-on-eks/docs/infra/misc/troubleshooting/"}}');var r=s(74848),t=s(28453);const l={sidebar_label:"Agents on EKS"},a="Agents on EKS",d={},c=[{value:"Why?",id:"why",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Core Components",id:"core-components",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Domain and Certificate Setup",id:"domain-and-certificate-setup",level:3},{value:"Tools Required",id:"tools-required",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Step 1: Clone and Navigate",id:"step-1-clone-and-navigate",level:3},{value:"Step 2: Configure Variables",id:"step-2-configure-variables",level:3},{value:"Step 3: Deploy",id:"step-3-deploy",level:3},{value:"Step 4: Configure kubectl",id:"step-4-configure-kubectl",level:3},{value:"Accessing Services",id:"accessing-services",level:2},{value:"GitLab",id:"gitlab",level:3},{value:"Langfuse",id:"langfuse",level:3},{value:"Milvus",id:"milvus",level:3},{value:"MCP Gateway Registry",id:"mcp-gateway-registry",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Restricting Inbound Access",id:"restricting-inbound-access",level:3},{value:"Cleanup",id:"cleanup",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"agents-on-eks",children:"Agents on EKS"})}),"\n",(0,r.jsx)(n.p,{children:"The Agents on EKS infrastructure deploys an environment that supports continuously building, deploying, and evaluating AI agents using open source tools in a secure, scalable, and reliable manner."}),"\n",(0,r.jsx)(n.h2,{id:"why",children:"Why?"}),"\n",(0,r.jsx)(n.p,{children:"Building and operating AI agents at scale requires more than just inference infrastructure. Agents need:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source control and CI/CD"})," for versioning agent code and configurations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Observability"})," for tracing agent behavior, evaluating performance, and debugging issues"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Persistent memory"})," for storing embeddings and enabling retrieval-augmented generation (RAG)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tool orchestration"})," for managing and discovering MCP (Model Context Protocol) servers"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This infrastructure brings together these components into a cohesive platform, enabling teams to iterate quickly on agent development while maintaining reliability."}),"\n",(0,r.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Development"}),": Build and test AI agents with integrated source control and CI/CD pipelines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agent Evaluation"}),": Use Langfuse to trace agent executions, evaluate outputs, and track performance over time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RAG Applications"}),": Store and retrieve embeddings using Milvus for knowledge-augmented agents"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MCP Tool Management"}),": Discover and manage MCP servers through the gateway registry"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-Agent Systems"}),": Deploy and orchestrate multiple agents with shared infrastructure"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.p,{children:"This infrastructure creates:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Amazon VPC"})," with public and private subnets across multiple availability zones"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Amazon EKS Cluster"})," with managed node groups for critical addons"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Karpenter"})," for intelligent node autoscaling based on workload demands"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitLab"})," for source control, container registry, and CI/CD pipelines"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Langfuse"})," for agent observability, tracing, and evaluation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Milvus"})," for vector storage and similarity search"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MCP Gateway Registry"})," for tool discovery and management"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://about.gitlab.com/",children:"GitLab"})}),(0,r.jsx)(n.td,{children:"Source control, container registry, and CI/CD for agent code"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://langfuse.com/",children:"Langfuse"})}),(0,r.jsx)(n.td,{children:"LLM observability, tracing, prompt management, and evaluation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://milvus.io/",children:"Milvus"})}),(0,r.jsx)(n.td,{children:"Vector database for embeddings and similarity search"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://github.com/agentic-community/mcp-gateway-registry",children:"MCP Gateway Registry"})}),(0,r.jsx)(n.td,{children:"Discovery and management of Model Context Protocol servers"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://karpenter.sh/",children:"Karpenter"})}),(0,r.jsx)(n.td,{children:"Kubernetes node autoscaling"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://argo-cd.readthedocs.io/",children:"ArgoCD"})}),(0,r.jsx)(n.td,{children:"GitOps continuous delivery"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.h3,{id:"domain-and-certificate-setup",children:"Domain and Certificate Setup"}),"\n",(0,r.jsx)(n.p,{children:"GitLab requires a valid TLS certificate, which requires owning a domain. You can use a subdomain from an existing domain."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create a Route53 Hosted Zone"})}),"\n",(0,r.jsxs)(n.p,{children:["Follow the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html",children:"AWS documentation to create a hosted zone"}),". For a subdomain, name it following the pattern ",(0,r.jsx)(n.code,{children:"subdomain.domain.tld"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"(Optional) Configure as Subdomain"})}),"\n",(0,r.jsxs)(n.p,{children:["If using a subdomain, add the hosted zone as a ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingNewSubdomain.html",children:"subdomain"})," to your main domain."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create an ACM Certificate"})}),"\n",(0,r.jsxs)(n.p,{children:["Follow the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/acm/latest/userguide/gs-acm-request-public.html",children:"ACM documentation to create a certificate"})," for your domain."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tools-required",children:"Tools Required"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"AWS CLI configured with appropriate permissions"}),"\n",(0,r.jsx)(n.li,{children:"Terraform >= 1.0"}),"\n",(0,r.jsx)(n.li,{children:"kubectl"}),"\n",(0,r.jsx)(n.li,{children:"Helm >= 3.0"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-clone-and-navigate",children:"Step 1: Clone and Navigate"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/awslabs/ai-on-eks.git\ncd ai-on-eks/infra/solutions/agents-on-eks\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-configure-variables",children:"Step 2: Configure Variables"}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"terraform/blueprint.tfvars"})," to set your domain:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'name                        = "aioeks-agents"\nenable_langfuse             = true\nenable_gitlab               = true\nenable_external_dns         = true\nenable_milvus               = true\nenable_mcp_gateway_registry = true\nmax_user_namespaces         = 16384\nacm_certificate_domain      = "agents.example.com"  # Update with your domain\nallowed_inbound_cidrs       = "0.0.0.0/0"           # Restrict inbound IPs\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-deploy",children:"Step 3: Deploy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./install.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"Deployment takes approximately 20 minutes."}),"\n",(0,r.jsx)(n.h3,{id:"step-4-configure-kubectl",children:"Step 4: Configure kubectl"}),"\n",(0,r.jsx)(n.p,{children:"After deployment, configure kubectl to access your cluster:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws eks update-kubeconfig --name aioeks-agents --region us-west-2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"accessing-services",children:"Accessing Services"}),"\n",(0,r.jsx)(n.h3,{id:"gitlab",children:"GitLab"}),"\n",(0,r.jsxs)(n.p,{children:["GitLab will be available at ",(0,r.jsx)(n.code,{children:"https://gitlab.<your-domain>"}),". Retrieve the root password:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get secret gitlab-gitlab-initial-root-password -n gitlab -o jsonpath='{.data.password}' | base64 -d\n"})}),"\n",(0,r.jsx)(n.h3,{id:"langfuse",children:"Langfuse"}),"\n",(0,r.jsx)(n.p,{children:"Access Langfuse through port-forwarding:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward svc/langfuse 3000:3000 -n langfuse\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then open ",(0,r.jsx)(n.code,{children:"http://localhost:3000"})," in your browser."]}),"\n",(0,r.jsx)(n.h3,{id:"milvus",children:"Milvus"}),"\n",(0,r.jsxs)(n.p,{children:["Connect to Milvus from within the cluster at ",(0,r.jsx)(n.code,{children:"milvus.milvus.svc.cluster.local:19530"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"mcp-gateway-registry",children:"MCP Gateway Registry"}),"\n",(0,r.jsxs)(n.p,{children:["The MCP Gateway Registry will be available at ",(0,r.jsx)(n.code,{children:"https://mcpregistry.<your-domain>"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name"})}),(0,r.jsx)(n.td,{children:"Cluster name"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"aioeks-agents"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"region"})}),(0,r.jsx)(n.td,{children:"AWS region"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"us-west-2"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"eks_cluster_version"})}),(0,r.jsx)(n.td,{children:"EKS version"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1.34"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"acm_certificate_domain"})}),(0,r.jsx)(n.td,{children:"Domain for TLS certificates"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:'""'})," (required)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"allowed_inbound_cidrs"})}),(0,r.jsx)(n.td,{children:"CIDR ranges allowed through load balancer"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.0.0.0/0"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_langfuse"})}),(0,r.jsx)(n.td,{children:"Deploy Langfuse"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_gitlab"})}),(0,r.jsx)(n.td,{children:"Deploy GitLab"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_milvus"})}),(0,r.jsx)(n.td,{children:"Deploy Milvus"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_mcp_gateway_registry"})}),(0,r.jsx)(n.td,{children:"Deploy MCP Gateway Registry"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_external_dns"})}),(0,r.jsx)(n.td,{children:"Enable External DNS for Route53"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"restricting-inbound-access",children:"Restricting Inbound Access"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"allowed_inbound_cidrs"})," variable controls which IP ranges can access services through the load balancer. Restrict this to your organization's IP ranges:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'allowed_inbound_cidrs = "10.0.0.0/8,192.168.1.0/24"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Ensure the CIDR includes your developer IPs and GitLab Runner node IPs for CI/CD pipelines."}),"\n",(0,r.jsx)(n.h2,{id:"cleanup",children:"Cleanup"}),"\n",(0,r.jsx)(n.p,{children:"To destroy the infrastructure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd terraform/_LOCAL\n./cleanup.sh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Configure GitLab CI/CD pipelines for your agent code"}),"\n",(0,r.jsx)(n.li,{children:"Set up Langfuse projects and API keys for tracing"}),"\n",(0,r.jsx)(n.li,{children:"Create Milvus collections for your embedding storage"}),"\n",(0,r.jsx)(n.li,{children:"Register MCP servers in the gateway registry"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453(e,n,s){s.d(n,{R:()=>l,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);